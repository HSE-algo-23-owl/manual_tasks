# Задание №15
# Задача о максимальном потоке минимальной стоимости.
## Постановка задачи
1. Дана сеть (взвешенный ориентированный граф) с источником s и стоком t.
2. Для каждой дуги определена пропускная способность и стоимость транспортировки.
3. Необходимо найти для указанной сети максимальный поток минимальной стоимости. 

### Вариант 4: 

| Дуги                      | se | ea | ec | ed | ab | cb | dc | bt | ct | dt |
|:--------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
| Пропускная способность    | 18 | 5  | 6  | 10 | 5  | 4  | 3  | 8  | 4  | 8  |
| Стоимость транспортировки | 1  | 2  | 3  | 2  | 1  | 1  | 1  | 2  | 3  | 5  |

### 1. Построим сеть с источником **s**, стоком **t** и указанными пропускными способностями дуг для поиска максимального потока.

```mermaid
graph LR
    s-->|18|e
    e-->|5|a
    e-->|6|c
    e-->|10|d
    a-->|5|b
    c-->|4|b
    d-->|3|c
    b-->|8|t
    c-->|4|t
    d-->|8|t
```
Построим остаточную сеть
```mermaid
graph LR
    e-.->|18|s
    a-.->|5|e
    c-.->|6|e
    d-.->|10|e
    b-.->|5|a
    b-.->|4|c
    c-.->|3|d
    t-.->|8|b
    t-.->|4|c
    t-.->|8|d
```
Возьмем увеличивающий путь t->c->e->s. Минимальный вес по пути составляет 4. Вычтем его из пути и составим остаточную сеть
```mermaid
graph LR
    e-.->|14|s
    s-->|4|e
    a-.->|5|e
    c-.->|2|e
    e-->|4|c
    d-.->|10|e
    b-.->|5|a
    b-.->|4|c
    c-.->|3|d
    t-.->|8|b
    c-->|4|t
    t-.->|8|d
```
Возьмем увеличивающий путь t->d->e->s. Минимальный вес по пути составляет 8. Вычтем его из пути и составим остаточную сеть
```mermaid
graph LR
    e-.->|6|s
    s-->|12|e
    a-.->|5|e
    c-.->|2|e
    e-->|4|c
    d-.->|2|e
    e-->|8|d
    b-.->|5|a
    b-.->|4|c
    c-.->|3|d
    t-.->|8|b
    c-->|4|t
    d-->|8|t
```
Возьмем увеличивающий путь t->b->a->e->s. Минимальный вес по пути составляет 5. Вычтем его из пути и составим остаточную сеть
```mermaid
graph LR
    e-.->|1|s
    s-->|17|e
    e-->|5|a
    c-.->|2|e
    e-->|4|c
    d-.->|2|e
    e-->|8|d
    a-->|5|b
    b-.->|4|c
    c-.->|3|d
    t-.->|3|b
    b-->|5|t
    c-->|4|t
    d-->|8|t
```
Возьмем увеличивающий путь t->b->c->e->s. Минимальный вес составляет по пути 1. Вычтем его из пути и составим остаточную сеть
```mermaid
graph LR
    s-->|18|e
    e-->|5|a
    c-.->|1|e
    e-->|5|c
    d-.->|2|e
    e-->|8|d
    a-->|5|b
    b-.->|3|c
    c-->|1|b
    c-.->|3|d
    t-.->|2|b
    b-->|6|t
    c-->|4|t
    d-->|8|t
```
### 2. Продолжим поиск увеличивающего пути в остаточной сети

В остаточной сети не найдено увеличивающих путей, следовательно, алгоритм завершил работу и найденный поток величиной 8 является максимальным для данной сети.

```mermaid
graph LR
    s-->|18,18|e
    e-->|5,5|a
    e-->|5,6|c
    e-->|8,10|d
    a-->|5,5|b
    c-->|1,4|b
    d-->|0,3|c
    b-->|6,8|t
    c-->|4,4|t
    d-->|8,8|t
```

### 3. Рассчитаем стоимость полученного максимального потока.

| Дуги                                          | se | ea | ec | ed | ab | cb | dc | bt | ct | dt |  Итого  |
|:----------------------------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:-------:|
| Пропускная способность p(e)                   | 18 | 5  | 6  | 10 | 5  | 4  | 3  | 8  | 4  | 8  |         |
| Локальный поток f(e)                          | 18 | 5  | 5  | 8  | 5  | 1  | 0  | 6  | 4  | 8  |         |
| Стоимость транспортировки единицы потока c(e) | 1  | 2  | 3  | 2  | 1  | 1  | 1  | 2  | 3  | 5  |         |
| Суммарная стоимость f(e)*c(e)                 | 18 | 10 | 15 | 16 | 5  | 1  | 0  | 12 | 12 | 40 | **129** |

### 4. Попробуем уменьшить стоимость потока для чего построим остаточную сеть.
Для каждого ребра остаточной сети укажем стоимость транспортировки единицы потока.

```mermaid
graph LR
    s-->|-1|e
    e-->|-2|a
    c-.->|+3|e
    e-->|-3|c
    d-.->|+2|e
    e-->|-2|d
    a-->|-1|b
    b-.->|+1|c
    c-->|-1|b
    c-.->|+1|d
    t-.->|+2|b
    b-->|-2|t
    c-->|-3|t
    d-->|-5|t
```
В остаточной сети найден ориентированный цикл отрицательной стоимости d -> t -> b -> c -> d (-5 +2 +1 +1 = -1). 

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**.
Минимальный вес ребра в цикле 2 - это неиспользованный резерв ребра t -> b.

Удалим найденный цикл - уменьшим на 2 вес всех ребер, входящих в цикл.

```mermaid
graph LR
    s-->|18|e
    e-->|5|a
    c-.->|1|e
    e-->|5|c
    d-.->|2|e
    e-->|8|d
    a-->|5|b
    b-.->|1|c
    c-->|3|b
    c-.->|1|d
    d-->|2|c
    b-->|8|t
    c-->|4|t
    d-->|6|t
    t-.->|2|d
```
### 5. Проведем повторный поиск цикла отрицательной стоимости в остаточной сети.
Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.
```mermaid
graph LR
    s-->|-1|e
    e-->|-2|a
    c-.->|+3|e
    e-->|-3|c
    d-.->|+2|e
    e-->|-2|d
    a-->|-1|b
    c-->|-1|b
    c-.->|+1|d
    t-.->|+2|b
    b-->|-2|t
    c-->|-3|t
    d-->|-5|t
```
В остаточной сети отсутствуют циклы отрицательной стоимости, следовательно, стоимость потока минимальна.
```mermaid
graph LR
    s-->|18,18|e
    e-->|5,5|a
    e-->|5,6|c
    e-->|8,10|d
    a-->|5,5|b
    c-->|3,4|b
    d-->|2,3|c
    b-->|8,8|t
    c-->|4,4|t
    d-->|6,8|t
```

| Дуги                                          | se | ea | ec | ed | ab | cb | dc | bt | ct | dt |  Итого  |
|:----------------------------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:-------:|
| Пропускная способность p(e)                   | 18 | 5  | 6  | 10 | 5  | 4  | 3  | 8  | 4  | 8  |         |
| Локальный поток f(e)                          | 18 | 5  | 5  | 8  | 5  | 3  | 2  | 8  | 4  | 6  |         |
| Стоимость транспортировки единицы потока c(e) | 1  | 2  | 3  | 2  | 1  | 1  | 1  | 2  | 3  | 5  |         |
| Суммарная стоимость f(e)*c(e)                 | 18 | 10 | 15 | 16 | 5  | 3  | 2  | 16 | 12 | 30 | **127** |

### Ответ:
Максимальный поток в сети равен 18, минимальная стоимость потока 127, она реализуется следующим локальными потоками:
```mermaid
graph LR
    s-->|18,18|e
    e-->|5,5|a
    e-->|5,6|c
    e-->|8,10|d
    a-->|5,5|b
    c-->|3,4|b
    d-->|2,3|c
    b-->|8,8|t
    c-->|4,4|t
    d-->|6,8|t
```